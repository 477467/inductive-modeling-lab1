# Спочатку встановлюємо потрібні бібліотеки
import subprocess
import sys
import os

def install_package(package):
    try:
        __import__(package)
    except ImportError:
        print(f"Встановлення {package}...")
        subprocess.check_call([sys.executable, "-m", "pip", "install", package])

# Список необхідних бібліотек
required_packages = ['pandas', 'numpy', 'matplotlib', 'scikit-learn']

for package in required_packages:
    if package == 'scikit-learn':
        install_package('sklearn')
    else:
        install_package(package)

print("Всі бібліотеки успішно встановлено!")

# Тепер імпортуємо бібліотеки
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.preprocessing import PolynomialFeatures
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error, r2_score
import warnings
warnings.filterwarnings('ignore')

# Створюємо повні дані з вашого CSV напряму в коді
full_data = """0.0;0.36029429141646563
1.0;0.5193954957803922
2.0;0.6784851275693603
3.0;0.8375631284876198
4.0;0.9966294404444288
5.0;1.1556840055557487
6.0;1.314726766145948
7.0;1.473757664749523
8.0;1.6327766441128295
9.000000000000014;1.7917836471958333
10.000000000000014;1.9507786171738686
11.000000000000014;1.8575761204327212
12.000000000000014;1.7643614775905017
13.000000000000014;1.6711346324793634
14.000000000000014;1.5778955291540162
15.000000000000014;1.4846441118935574
16.000000000000014;1.3913803252033161
17.000000000000014;1.2981041138167149
18.000000000000014;1.204815422697141
19.000000000000014;1.1115141970398354
20.000000000000014;1.018200382273792
21.000000000000014;1.1032274328831724
22.000000000000014;1.1882417859507421
23.000000000000014;1.2732433876183071
24.00000000000003;1.3582321842691707
25.00000000000003;1.443208122530109
26.00000000000003;1.5281711492733523
27.00000000000003;1.613121211618586
28.00000000000003;1.6980582569349645
29.00000000000003;1.7829822328431366
30.00000000000003;1.8678930872172876
31.00000000000003;1.8408840116871374
32.00000000000003;1.8138617111401805
33.00000000000003;1.7868261342235974
34.00000000000003;1.7597772298464103
35.00000000000003;1.7327149471815917
36.00000000000003;1.7056392356681918
37.00000000000003;1.6785500450134756
38.00000000000003;1.6514473251950772
39.00000000000003;1.6243310264631652
40.00000000000003;1.5972010993426258
41.00000000000003;1.6207204132064352
42.00000000000003;1.644226000564331
43.00000000000003;1.6677178127785717
44.00000000000003;1.6911958014949973
45.00000000000003;1.714659918645277
46.00000000000003;1.7381101164491761
47.00000000000003;1.7615463474168338
48.00000000000006;1.7849685643510556
49.00000000000006;1.808376720349621
50.00000000000006;1.8317707688076028
51.00000000000006;1.7741087598245888
52.00000000000006;1.7164325509923726
53.00000000000006;1.6587420966119737
54.00000000000006;1.6010373512911287
55.00000000000006;1.5433182699466805
56.00000000000006;1.4855848078069842
57.00000000000006;1.4278369204143255
58.00000000000006;1.3700745636273517
59.00000000000006;1.31229769362352
60.00000000000006;1.2545062669015583
61.00000000000006;1.2689448674651147
62.00000000000006;1.2833688252817155
63.00000000000006;1.2977780978287994
64.00000000000006;1.3121726429150566
65.00000000000006;1.3265524186829591
66.00000000000006;1.3409173836113049
67.00000000000006;1.3552674965177753
68.00000000000006;1.3696027165615106
69.00000000000006;1.3839230032456917
70.00000000000006;1.3982283164201441
71.00000000000006;1.3826399056339984
72.00000000000006;1.367036442088174
73.00000000000006;1.3514178866881676
74.00000000000006;1.3357842006966583
75.00000000000006;1.3201353457361797
76.00000000000006;1.3044712837918047
77.00000000000006;1.288791977213841
78.00000000000006;1.2730973887205461
79.00000000000006;1.2573874814008503
80.00000000000006;1.2416622187170996
81.00000000000009;1.2838014740945152
82.00000000000009;1.32592530216384
83.00000000000009;1.368033667524244
84.00000000000009;1.4101265351594099
85.00000000000009;1.452203870440346
86.00000000000009;1.4942656391282074
87.00000000000009;1.5363118073771362
88.00000000000009;1.5783423417371132
89.00000000000009;1.6203572091568206
90.00000000000009;1.6623563769865266
91.00000000000009;1.7168591095031525
92.00000000000009;1.7713460783466506
93.00000000000009;1.8258172520894578
94.00000000000009;1.8802725997172534
95.00000000000009;1.934712090631908
96.00000000000009;1.9891356946544496
97.00000000000009;2.0435433820280395
98.00000000000009;2.097935123420964
99.00000000000009;2.152310889929641
100.00000000000009;2.2066706530816376
101.00000000000006;2.247687946011692
102.00000000000009;2.2886891799458042
103.00000000000011;2.329674327723248
104.00000000000009;2.370643362626668
105.00000000000006;2.4115962583851696
106.00000000000009;2.4525329891774197
107.00000000000011;2.493453529634761
108.00000000000009;2.534357854844347
109.00000000000009;2.5752459403522896
110.00000000000009;2.6161177621668172
111.00000000000011;2.5982393172749956
112.00000000000011;2.5803445621052634
113.00000000000009;2.562433474071288
114.00000000000011;2.5445060310616285
115.00000000000011;2.52656221144297
116.00000000000011;2.5086019940633593
117.00000000000009;2.4906253582554667
118.00000000000011;2.4726322838398542
119.00000000000011;2.454622751128266
120.00000000000011;2.436596740926922
121.00000000000009;2.325503792723487
122.00000000000011;2.2143943301394327
123.00000000000014;2.103268335484351
124.00000000000011;1.9921257915756505
125.00000000000009;1.8809666817419124
126.00000000000011;1.769790989826285
127.00000000000014;1.6585987001898892
128.0000000000001;1.5473897977152207
129.00000000000009;1.4361642678095647
130.0000000000001;1.3249220964084445
131.00000000000014;1.3090377574954912
132.0000000000001;1.293136750556677
133.00000000000009;1.2772190631330183
134.0000000000001;1.2612846833076652
135.00000000000014;1.2453335997094117
136.0000000000001;1.2293658015162177
137.0000000000001;1.2133812784587437
138.0000000000001;1.1973800208239047
139.00000000000014;1.1813620194584329
140.0000000000001;1.1653272657724583
141.0000000000001;1.2072948458581079
142.0000000000001;1.2492456581480886
143.00000000000014;1.29117969576433
144.0000000000001;1.333096952406612
145.0000000000001;1.3749974223562198
146.00000000000014;1.4168811004795994
147.00000000000014;1.458747982232033
148.00000000000014;1.5005980636613323
149.0000000000001;1.5424313414115471
150.00000000000014;1.5842478127266806
151.00000000000017;1.5886887371503169
152.00000000000014;1.5931128514416726
153.0000000000001;1.5975201546670572
154.00000000000014;1.601910646507746
155.00000000000017;1.606284327263771
156.0000000000001;1.6106411978577206
157.0000000000001;1.6149812598385553
158.0000000000001;1.619304515385443
159.00000000000017;1.6236109673115975
160.0000000000001;1.627900619068139
161.0000000000001;1.706672730846627
162.00000000000017;1.7854280512869702
163.00000000000017;1.864166585777297
164.00000000000017;1.9428883403592143
165.0000000000001;2.021593321731742
166.00000000000017;2.1002815372552526
167.00000000000017;2.1789529949554165
168.00000000000017;2.2576077035271798
169.0000000000001;2.336245672338757
170.00000000000017;2.414866911435621
171.00000000000017;2.4156035645139022
172.00000000000017;2.416323510016242
173.0000000000001;2.4170267600440116
174.00000000000017;2.4177133273919744
175.00000000000017;2.4183832255523523
176.00000000000017;2.419036468718906
177.0000000000001;2.419673071791035
178.00000000000017;2.420293050377882
179.00000000000017;2.4208964208024626
180.00000000000017;2.421483200105799
181.0000000000001;2.3652049731557754
182.00000000000017;2.3089101913371954
183.00000000000017;2.2525988738700757
184.00000000000017;2.1962710407091297
185.0000000000001;2.139926712547976
186.00000000000017;2.0835659108233604
187.00000000000017;2.0271886577193974
188.00000000000017;1.9707949761718169
189.00000000000017;1.9143848898722204
190.00000000000017;1.8579584232723665
191.00000000000017;1.878651317064997
192.00000000000017;1.8993278817585377
193.00000000000017;1.919988144111022
194.00000000000017;1.9406321316578887
195.00000000000017;1.961259872716327
196.00000000000017;1.9818713963896426
197.00000000000017;2.002466732571633
198.00000000000017;2.0230459119509745
199.00000000000023;2.0436089660156256
200.00000000000017;2.064155927057245
201.00000000000017;1.949735833630046
202.00000000000017;1.8352997141919727
203.00000000000023;1.7208476034724367
204.00000000000017;1.6063795370223601
205.00000000000017;1.4918955512186511
206.00000000000017;1.377395683268718
207.00000000000023;1.2628799712149925
208.00000000000017;1.1483484539394495
209.00000000000017;1.0338011711681405
210.00000000000017;0.919238163475762
211.00000000000023;0.9975752362820165
212.00000000000017;1.0758966678808333
213.00000000000017;1.1542025014203308
214.00000000000017;1.2324927809156394
215.00000000000023;1.3107675512535222
216.00000000000017;1.3890268581970233
217.00000000000017;1.4672707483901293
218.00000000000017;1.5454992693624299
219.00000000000023;1.6237124695337979
220.00000000000017;1.7019103982190895
221.00000000000017;1.731979136801371
222.00000000000017;1.7620327052311124
223.00000000000023;1.7920711555364481
224.00000000000023;1.8220945406594253
225.00000000000017;1.8521029144607721
226.00000000000023;1.882096331724678
227.00000000000023;1.9120748481635843
228.00000000000023;1.9420385204229955
229.00000000000017;1.9719874060863065
230.00000000000023;2.0019215636796353
231.00000000000023;1.9414212999165812
232.00000000000023;1.8809064279833667
233.00000000000017;1.820377009263436
234.00000000000023;1.7598331061024441
235.00000000000023;1.6992747818131688
236.00000000000023;1.6387021006804243
237.00000000000017;1.5781151279659933
238.00000000000023;1.5175139299135771
239.00000000000023;1.456898573753768
240.00000000000023;1.396269127709018
241.00000000000017;1.465768822389803
242.00000000000023;1.5352545666261004
243.00000000000023;1.6047264316459358
244.00000000000023;1.674184489689239
245.00000000000017;1.743628814012901
246.00000000000023;1.8130594788958225
247.00000000000023;1.882476559643988
248.00000000000023;1.951880132595557
249.00000000000023;2.0212702751259726
250.00000000000023;2.090647065653073
251.00000000000023;2.098755240518207
252.00000000000023;2.10685022336341
253.00000000000023;2.11493209576454
254.00000000000023;2.12300094036045
255.00000000000023;2.1310568408581845
256.0000000000002;2.1390998820381677
257.0000000000002;2.1471301497594286
258.0000000000002;2.1551477309648237
259.0000000000002;2.1631527136862783
260.0000000000002;2.171145187050046
261.0000000000002;2.2014230063993554
262.0000000000002;2.2316884979475597
263.0000000000002;2.2619417541355675
264.0000000000002;2.2921828685197783
265.0000000000002;2.3224119357774096
266.0000000000002;2.3526290517118396
267.0000000000003;2.3828343132579497
268.0000000000002;2.413027818487505
269.0000000000002;2.4432096666145307
270.0000000000002;2.4733799580007103
271.0000000000003;2.4557972650105406
272.0000000000002;2.438203219467511
273.0000000000002;2.42059792520879
274.0000000000002;2.4029814872409223
275.0000000000003;2.3853540117453025
276.0000000000002;2.3677156060836513
277.0000000000002;2.3500663788035054
278.0000000000002;2.3324064396437305
279.0000000000003;2.3147358995400427
280.0000000000002;2.2970548706305407
281.0000000000002;2.310840500040753
282.0000000000002;2.324615868550717
283.0000000000003;2.3383810919390386
284.0000000000002;2.352136287208993
285.0000000000002;2.3658815725941267
286.0000000000002;2.3796170675638804
287.0000000000003;2.393342892829219
288.0000000000002;2.40705917034828
289.0000000000002;2.4207660233320385
290.0000000000003;2.434463576249979
291.0000000000003;2.4354733671346023
292.0000000000003;2.4364741106906775
293.0000000000002;2.437465935197413
294.0000000000003;2.4384489702153678
295.0000000000003;2.439423346592198
296.0000000000003;2.44038919646842
297.0000000000002;2.4413466532831767
298.0000000000003;2.4422958517800293
299.0000000000003;2.4432369280127575
300.0000000000003;2.444170019351176
301.0000000000002;2.4683341579685094
302.00000000000034;2.492490590402596
303.0000000000003;2.516639458006378
304.0000000000003;2.5407809034722395
305.0000000000002;2.564915070837884
306.0000000000002;2.5890421054922297
307.0000000000003;2.613162154181334
308.0000000000003;2.637275365014304
309.0000000000002;2.661381887469254
310.00000000000034;2.6854818723992544
311.0000000000003;2.6092425882903645
312.0000000000003;2.532997072511414
313.0000000000002;2.456745480076208
314.0000000000002;2.3804879673974635
315.0000000000003;2.3042246922928347
316.0000000000003;2.227955813990972
317.0000000000003;2.1516814931375396
318.00000000000034;2.075401891801301
319.0000000000003;1.9991171734802176
320.0000000000003;1.9228275031075062
321.0000000000003;1.9764875997761797
322.0000000000002;2.0301430785899455
323.0000000000003;2.0837941088245646
324.0000000000003;2.137440861215576
325.0000000000003;2.1910835079644935
326.00000000000034;2.244722222744967
327.00000000000034;2.29835718070896
328.0000000000003;2.35198855849299
329.0000000000003;2.4056165342243245
330.0000000000002;2.459241287527224
331.00000000000034;2.4797959269779226
332.0000000000003;2.5003477077646865
333.0000000000003;2.520896814040299
334.00000000000034;2.5414434314796144
335.00000000000034;2.5619877472858534
336.0000000000003;2.5825299501969385
337.0000000000003;2.603070230491813
338.0000000000002;2.6236087799967924
339.00000000000034;2.6441457920919276
340.0000000000003;2.664681461717368
341.0000000000003;2.655624018646745
342.00000000000034;2.6465656276926257
343.00000000000034;2.6375064885138695
344.0000000000003;2.6284468023550818
345.0000000000003;2.619386772053053
346.0000000000003;2.6103266020432225
347.00000000000034;2.601266498366146
348.0000000000003;2.5922066686739873
349.0000000000003;2.583147322237013
350.00000000000034;2.574088669950107
351.00000000000034;2.4765787692651573
352.00000000000034;2.3790699894200333
353.0000000000003;2.281562546222705
354.0000000000003;2.1840566571319564
355.00000000000034;2.0865525412639627
356.00000000000034;1.9890504193989236
357.0000000000003;1.8915505139876214
358.00000000000034;1.794053049158076
359.00000000000034;1.696558250722208
360.00000000000034;1.5990663461824408
361.0000000000003;1.7777603511307962
362.0000000000003;1.9564577100783942
363.00000000000034;2.1351586556393376
364.00000000000034;2.3138634221449643
365.0000000000003;2.4925722456506727
366.00000000000034;2.6712853639426055
367.00000000000034;2.8500030165443575
368.00000000000034;3.0287254447238356
369.0000000000003;3.2074528914999756
370.0000000000003;3.386185601649551
371.00000000000034;3.3063649365462027
372.00000000000034;3.2265500296706047
373.0000000000003;3.1467411311139397
374.0000000000004;3.0669384927525427
375.00000000000034;2.987142368254789
376.00000000000034;2.907353013087925
377.00000000000034;2.8275706845249906
378.0000000000003;2.7477956416517175
379.00000000000034;2.6680281453734387
380.00000000000034;2.5882684584220557
381.00000000000034;2.610878975030656
382.0000000000004;2.633497831937356
383.00000000000034;2.6561252973954126
384.00000000000034;2.678761641512506
385.00000000000034;2.701407136257736
386.0000000000003;2.724062055468641
387.00000000000034;2.7467266748582344
388.00000000000034;2.7694012720220367
389.00000000000034;2.7920861264451498
390.0000000000004;2.8147815195093253
391.00000000000034;2.691419775245009
392.00000000000034;2.5680691381035583
393.00000000000034;2.4447298951992478
394.0000000000003;2.321402335571432
395.0000000000004;2.19808675019168
396.00000000000034;2.074783431970975
397.00000000000034;1.951492675766821
398.0000000000004;1.828214778390459
399.0000000000004;1.7049500386141008
400.00000000000034;1.5816987571780763
401.00000000000034;1.6522700557397363
402.00000000000034;1.722855420055782
403.0000000000004;1.793455156814429
404.00000000000034;1.8640695747010176
405.00000000000034;1.9346989844053302
406.0000000000004;2.0053436986288715
407.0000000000004;2.0760040320921624
408.00000000000034;2.1466803015421014
409.00000000000034;2.2173728257592744
410.00000000000034;2.2880819255653204
411.0000000000004;2.2939904816975956
412.00000000000034;2.29991626121465
413.00000000000034;2.30585959110553
414.00000000000045;2.3118208004298815
415.00000000000034;2.3178002203253754
416.00000000000034;2.323798184015141
417.00000000000034;2.329815026815222
418.00000000000034;2.3358510861420374
419.00000000000034;2.341906701519861
420.00000000000034;2.347982214588313
421.00000000000034;2.3024807076798077
422.00000000000045;2.2569997881172523
423.00000000000045;2.2115398039314154
424.00000000000034;2.1661011052985084
425.00000000000034;2.12068404454777
426.00000000000034;2.0752889761690354
427.00000000000045;2.0299162568203224
428.00000000000034;1.9845662453354538
429.00000000000034;1.93923930273165
430.00000000000045;1.8939357922171747
431.00000000000045;1.9467992271815318
432.00000000000034;1.999686827255485
433.00000000000034;2.052598962266365
434.00000000000034;2.105536004263216
435.00000000000045;2.158498327524499
436.00000000000034;2.211486308565795
437.00000000000034;2.2645003261475574
438.00000000000045;2.317540761282849
439.00000000000045;2.3706079972450786
440.00000000000034;2.423702419575808
441.00000000000034;2.470173289199441
442.00000000000034;2.5166721231102516
443.00000000000045;2.563199313700983
444.00000000000034;2.6097552556637265
445.00000000000034;2.6563403459977972
446.00000000000045;2.702954984017572
447.00000000000045;2.749599571360345
448.00000000000045;2.796274511994245
449.00000000000034;2.8429802122261076
450.00000000000034;2.8897170807093975
451.00000000000045;2.846597498316124
452.00000000000045;2.80350990855281
453.00000000000034;2.760454727160408
454.00000000000045;2.7174323722582883
455.00000000000045;2.674443264352226
456.00000000000045;2.63148782634238
457.00000000000034;2.588566483531316
458.00000000000034;2.545679663632023
459.00000000000045;2.502827796775953
460.00000000000045;2.4600113155210845
461.00000000000034;2.483869627088519
462.00000000000045;2.5077641966849202
463.00000000000045;2.531695464196254
464.00000000000045;2.555663871967354
465.00000000000034;2.579669864810038
466.00000000000034;2.6037138900112438
467.00000000000045;2.6277963973411795
468.00000000000045;2.6519178390614817
469.00000000000034;2.6760786699334047
470.00000000000045;2.7002793472260054
471.00000000000045;2.720600195951262
472.00000000000045;2.7409618131915474
473.00000000000045;2.7613646637886116
474.00000000000034;2.781809215124917
475.00000000000045;2.8022959371318947
476.00000000000045;2.8228253022982184
477.00000000000045;2.8433977856781008
478.00000000000045;2.864013864899592
479.00000000000045;2.884674020172896
480.00000000000045;2.9053787342987074
481.00000000000045;2.87365402289105
482.00000000000034;2.8419748437421415
483.00000000000045;2.810341687474262
484.00000000000045;2.778755047333652
485.00000000000045;2.747215419198897
486.00000000000045;2.7157233015893505
487.00000000000045;2.6842791956735743
488.00000000000045;2.6528836052777622
489.00000000000045;2.621537036894209
490.00000000000034;2.5902399996897794
491.00000000000045;2.592369962198253
492.00000000000045;2.5945504822772425
493.00000000000045;2.5967820771682866
494.00000000000045;2.5990652668215195
495.00000000000045;2.6014005739042108
496.00000000000045;2.6037885238093175
497.00000000000045;2.606229644664058
498.00000000000045;2.6087244673384906
499.00000000000045;2.6112735254541155
500.00000000000045;2.613877355392477
501.00000000000045;2.628043650248714
502.00000000000045;2.6422657980054485
503.00000000000045;2.6565443433761815
504.00000000000045;2.6708798338690483
505.00000000000045;2.6852728197955003
506.00000000000045;2.6997238542789948
507.00000000000045;2.7142334932637096
508.00000000000045;2.7288022955232574
509.00000000000045;2.743430822669433
510.00000000000045;2.758119639160959
511.00000000000045;2.7955455570281007
512.0000000000005;2.8330329017338896
513.0000000000005;2.8705822463304735
514.0000000000005;2.908194166752071
515.0000000000005;2.9458692418237957
516.0000000000005;2.983608053270476
517.0000000000005;3.0214111857255235
518.0000000000005;3.0592792267397875
519.0000000000005;3.097212766790421
520.0000000000005;3.13521239928979
521.0000000000005;3.0807143689255883
522.0000000000005;3.0262836266760886
523.0000000000005;2.9719207748127427
524.0000000000005;2.9176264185779215
525.0000000000005;2.8634011661938468
526.0000000000005;2.8092456288715804
527.0000000000005;2.755160420820028
528.0000000000005;2.701146159254911
529.0000000000005;2.6472034644078017
530.0000000000005;2.5933329595351515
531.0000000000005;2.6058998950107286
532.0000000000005;2.618540276084486
533.0000000000005;2.631254735141829
534.0000000000006;2.6440439076293014
535.0000000000005;2.65690843206368
536.0000000000005;2.6698489500411
537.0000000000005;2.6828661062461725
538.0000000000005;2.695960548461135
539.0000000000005;2.709132927575003
540.0000000000005;2.722383897592735
541.0000000000005;2.8241577447781134
542.0000000000006;2.92601150026189
543.0000000000005;3.027945827452017
544.0000000000005;3.1299613929092427
545.0000000000005;3.232058866356313
546.0000000000005;3.3342389206872394
547.0000000000005;3.4365022319765695
548.0000000000005;3.53884947948864
549.0000000000005;3.6412813456869184
550.0000000000006;3.743798516243295
551.0000000000005;3.691223395764284
552.0000000000005;3.638734960649682
553.0000000000005;3.5863339062526247
554.0000000000005;3.5340209311720385
555.0000000000006;3.481796737262028
556.0000000000005;3.4296620296412788
557.0000000000005;3.377617516702442
558.0000000000006;3.325663910121568
559.0000000000006;3.273801924867559
560.0000000000005;3.222032279211584
561.0000000000005;3.1914874663832817
562.0000000000005;3.161036439640091
563.0000000000006;3.1306799272168817
564.0000000000005;3.1004186606887534
565.0000000000005;3.0702533749805374
566.0000000000006;3.0401848083763463
567.0000000000006;3.0102137025291227
568.0000000000005;2.9803408024701863
569.0000000000005;2.95056685661882
570.0000000000005;2.9208926167918587
571.0000000000006;2.9899067412747162
572.0000000000005;3.059022085646721
573.0000000000005;3.128239411975036
574.0000000000006;3.1975594857628766
575.0000000000006;3.2669830759591485
576.0000000000005;3.336510954968152
577.0000000000005;3.4061438986592494
578.0000000000005;3.4758826863765755
579.0000000000006;3.5457281009487502
580.0000000000006;3.615680928698593
581.0000000000005;3.6143878385419557
582.0000000000006;3.613203744730277
583.0000000000006;3.6121294441275382
584.0000000000006;3.6111657371309938
585.0000000000005;3.6103134276809645
586.0000000000005;3.6095733232706544
587.0000000000006;3.608946234955975
588.0000000000006;3.608432977365389
589.0000000000005;3.608034368709765
590.0000000000006;3.607751230792242
591.0000000000006;3.616604224680528
592.0000000000006;3.6255743437295647
593.0000000000005;3.6346624205786693
594.0000000000005;3.643869291499044
595.0000000000006;3.6531957964037263
596.0000000000006;3.6626427788575273
597.0000000000005;3.6722110860870107
598.0000000000006;3.681901568990469
599.0000000000006;3.691715082147917
600.0000000000006;3.701652483831101
601.0000000000005;3.806874592789574
602.0000000000005;3.91222231793258
603.0000000000006;4.0176965286672655
604.0000000000006;4.123298098132654
605.0000000000006;4.2290279032097855
606.0000000000006;4.334886824531775
607.0000000000006;4.440875746493897
608.0000000000006;4.54699555726376
609.0000000000006;4.653247148791402
610.0000000000005;4.75963141681945
611.0000000000006;4.60509837358996
612.0000000000006;4.450699809764572
613.0000000000006;4.296436632524698
614.0000000000006;4.142309752885068
615.0000000000006;3.9883200857039953
616.0000000000006;3.834468549693529
617.0000000000006;3.680756067429749
618.0000000000005;3.5271835653630146
619.0000000000006;3.3737519738282264
620.0000000000006;3.2204622270551697
621.0000000000006;3.313862526101978
622.0000000000006;3.407406550095779
623.0000000000006;3.5010952450127113
624.0000000000006;3.594929560765075
625.0000000000006;3.688910451211655
626.0000000000005;3.7830388741681036
627.0000000000006;3.8773157914173315
628.0000000000006;3.9717421687198806
629.0000000000006;4.0663189758243785
630.0000000000006;4.161047186477958
631.0000000000006;4.161173781244239
632.0000000000006;4.161453739091091
633.0000000000006;4.161888045823827
634.0000000000006;4.162477691288101
635.0000000000006;4.163223669380418
636.0000000000006;4.164126978058635
637.0000000000006;4.165188619352496
638.0000000000006;4.166409599374165
639.0000000000006;4.1677909283287855
640.0000000000006;4.16933362052504
641.0000000000006;4.180370455995508
642.0000000000006;4.1915706956779575
643.0000000000006;4.202935366255261
644.0000000000006;4.214465498556235
645.0000000000006;4.226162127566298
646.0000000000006;4.238026292438115
647.0000000000006;4.2500590365022575
648.0000000000006;4.262261407277888
649.0000000000006;4.274634456483456
650.0000000000006;4.2871792400474025
651.0000000000006;4.294892683605726
652.0000000000006;4.302779986052184
653.0000000000006;4.310842216009583
654.0000000000007;4.31908044635369
655.0000000000006;4.3274957542240085
656.0000000000006;4.336089221034577
657.0000000000006;4.34486193248477
658.0000000000006;4.35381497857012
659.0000000000006;4.362949453593151
660.0000000000006;4.372266456174221
661.0000000000006;4.312206236327351
662.0000000000007;4.2523307542762065
663.0000000000006;4.192641121659897
664.0000000000006;4.133138454478881
665.0000000000006;4.073823873105909
666.0000000000006;4.014698502296948
667.0000000000006;3.9557634712021175
668.0000000000006;3.897019913376673
669.0000000000006;3.8384689667919543
670.0000000000007;3.7801117738463756
671.0000000000006;3.8827800071391123
672.0000000000006;3.9856442921930997
673.0000000000006;4.088705784754068
674.0000000000006;4.191965645038914
675.0000000000006;4.295425037746768
676.0000000000006;4.399085132070044
677.0000000000006;4.502947101705547
678.0000000000007;4.6070121248655775
679.0000000000007;4.711281384289003
680.0000000000006;4.815756067252433
681.0000000000006;4.794388772159113
682.0000000000006;4.773229288816755
683.0000000000007;4.7522788181820275
684.0000000000006;4.731538565793984
685.0000000000006;4.711009741785228
686.0000000000007;4.690693560893147
687.0000000000007;4.670591242471137
688.0000000000006;4.650704010499827
689.0000000000006;4.6310330935983455
690.0000000000006;4.611579725035576
691.0000000000007;4.743242529056452
692.0000000000006;4.875125361948227
693.0000000000006;5.007229470996825
694.0000000000007;5.13955610818314
695.0000000000007;5.272106530194327
696.0000000000006;5.4048819984352425
697.0000000000006;5.53788377903975
698.0000000000006;5.671113142882104
699.0000000000007;5.804571365588367
700.0000000000007;5.938259727547775
701.0000000000005;5.937436727532822
702.0000000000007;5.936846441884803
703.0000000000007;5.936490165351138
704.0000000000007;5.936369197488215
705.0000000000006;5.936484842672855
706.0000000000006;5.936838410113818
707.0000000000007;5.937431213863299
708.0000000000006;5.93826457282844
709.0000000000007;5.939339810782878
710.0000000000007;5.940658256378271
711.0000000000007;6.089717410126997
712.0000000000007;6.239022443500362
713.0000000000006;6.388574699853552
714.0000000000006;6.538375527466106
715.0000000000006;6.688426279553529
716.0000000000007;6.838728314278973
717.0000000000006;6.989282994764717
718.0000000000007;7.140091689104143
719.0000000000007;7.291155770373024
720.0000000000007;7.442476616641496
721.0000000000006;7.351775406394139
722.0000000000006;7.261333732316219
723.0000000000008;7.171152987530886
724.0000000000006;7.081234570202507
725.0000000000007;6.9915798835482414
726.0000000000007;6.902190335850037
727.0000000000007;6.8130673404662305
728.0000000000007;6.724212315843441
729.0000000000007;6.635626685528349
730.0000000000006;6.54731187817954
731.0000000000006;6.685297001061872
732.0000000000007;6.8235558196107275
733.0000000000006;6.9620897778913955
734.0000000000007;7.100900325128673
735.0000000000007;7.239988915718422
736.0000000000007;7.379357009239743
737.0000000000007;7.519006070466787
738.0000000000006;7.658937569380707
739.0000000000008;7.799152981181638
740.0000000000006;7.93965378630054
741.0000000000007;7.829626336221992
742.0000000000007;7.719887256064256
743.0000000000007;7.6104380420230555
744.0000000000007;7.501280195573051
745.0000000000007;7.392415223479871
746.0000000000006;7.283844637812155
747.0000000000006;7.175569955953614
748.0000000000008;7.067592700615098
749.0000000000006;6.95991439984677
750.0000000000007;6.852536587050013
751.0000000000007;7.031566319103716
752.0000000000007;7.210899622034488
753.0000000000007;7.390538045370609
754.0000000000007;7.570483144040269
755.0000000000008;7.750736478383776
756.0000000000006;7.931299614165588
757.0000000000007;8.112174122586868
758.0000000000007;8.29336158029725
759.0000000000007;8.47486356940742
760.0000000000007;8.656681677501211
761.0000000000007;8.666490761840224
762.0000000000007;8.676619156799086
763.0000000000006;8.687068466454761
764.0000000000008;8.697840300406513
765.0000000000006;8.708936273788192
766.0000000000007;8.720358007280618
767.0000000000007;8.732107127123864
768.0000000000007;8.744185265129659
769.0000000000007;8.756594058693738
770.0000000000007;8.769335150808226
771.0000000000008;8.796747401558038
772.0000000000006;8.824495253681302
773.0000000000008;8.852580367033802
774.0000000000007;8.881004407117361
775.0000000000007;8.90976904509235
776.0000000000007;8.938875957790136
777.0000000000007;8.968326827725571
778.0000000000007;8.998123343109478
779.0000000000007;9.028267197861174
780.0000000000008;9.058760091620995
781.0000000000006;9.036901322604775
782.0000000000007;9.015395009090541
783.0000000000007;8.994242867956967
784.0000000000007;8.973446621853967
785.0000000000007;8.9530079992153
786.0000000000007;8.93292873427119
787.0000000000008;8.913210567060936
788.0000000000006;8.893855243445556
789.0000000000008;8.874864515120429
790.0000000000008;8.856240139627982
791.0000000000007;8.953702413707894
792.0000000000007;9.051534573297133
793.0000000000007;9.149738393555339
794.0000000000007;9.248315655539972
795.0000000000007;9.347268146219067
796.0000000000008;9.446597658483993
797.0000000000006;9.54630599116211
798.0000000000008;9.646394949029766
799.0000000000007;9.746866342824816
800.0000000000007;9.847721989259641
801.0000000000007;9.962928939217033
802.0000000000007;10.07852379321355
803.0000000000007;10.19450838596186
804.0000000000007;10.310884558200431
805.0000000000008;10.42765415670644
806.0000000000008;10.544819034308556
807.0000000000007;10.662381049899984
808.0000000000007;10.780342068451308
809.0000000000007;10.898703961023394
810.0000000000007;11.017468604780403
811.0000000000007;11.108164227748631
812.0000000000008;11.19926637459171
813.0000000000008;11.29077694086134
814.0000000000008;11.382697828264433
815.0000000000008;11.4750309446761
816.0000000000007;11.567778204152644
817.0000000000007;11.660941526944644
818.0000000000007;11.754522839509994
819.0000000000007;11.848524074526964
820.0000000000007;11.942947170907312
821.0000000000008;11.998661156873622
822.0000000000008;12.054800900779608
823.0000000000008;12.111368360316085
824.0000000000007;12.168365499459798
825.0000000000007;12.225794288486597
826.0000000000007;12.283656703984603
827.0000000000007;12.34195472886738
828.0000000000008;12.400690352387146
829.0000000000008;12.459865570147949
830.0000000000008;12.519482384118954
831.0000000000008;12.609706269009129
832.0000000000007;12.700375773195999
833.0000000000007;12.79149291782342
834.0000000000007;12.883059730453382
835.0000000000007;12.97507824507926
836.0000000000007;13.067550502139168
837.0000000000008;13.160478548529253
838.0000000000008;13.253864437617002
839.0000000000008;13.347710229254652
840.0000000000008;13.442017989792529
841.0000000000007;13.447877861793977
842.0000000000007;13.45420385494407
843.0000000000007;13.460998055167703
844.0000000000008;13.468262554941456
845.0000000000008;13.475999453307006
846.0000000000008;13.484210855884614
847.0000000000008;13.492898874886535
848.0000000000008;13.50206562913055
849.0000000000007;13.511713244053412
850.0000000000007;13.521843851724354
851.0000000000007;13.647127924624664
852.0000000000007;13.772899274363109
853.0000000000008;13.899160052987567
854.0000000000008;14.025912419232517
855.0000000000008;14.15315853853271
856.0000000000008;14.28090058303668
857.0000000000007;14.409140731620374
858.0000000000007;14.537881169900732
859.0000000000007;14.66712409024938
860.0000000000009;14.796871691806231
861.0000000000008;14.902625766524306
862.0000000000008;15.008888941089877
863.0000000000008;15.115663435029715
864.0000000000008;15.2229514746936
865.0000000000008;15.330755293268028
866.0000000000007;15.439077130789936
867.0000000000007;15.547919234160446
868.0000000000007;15.657283857158617
869.0000000000008;15.767173260455243
870.0000000000008;15.877589711626545
871.0000000000008;15.918983165695671
872.0000000000008;15.960908223563699
873.0000000000008;16.003367173606204
874.0000000000007;16.046362311159527
875.0000000000007;16.089895938534625
876.0000000000009;16.133970365030937
877.0000000000008;16.17858790695026
878.0000000000008;16.22375088761065
879.0000000000008;16.26946163736033
880.0000000000008;16.315722493591633
881.0000000000008;16.442628028627663
882.0000000000007;16.57008836611797
883.0000000000007;16.69810586467081
884.0000000000007;16.826682889994363
885.0000000000009;16.95582181491073
886.0000000000008;17.085525019369914
887.0000000000008;17.21579489046385
888.0000000000008;17.346633822440477
889.0000000000008;17.478044216717752
890.0000000000008;17.610028481897693
891.0000000000007;17.722811947871563
892.0000000000009;17.836174123560774
893.0000000000009;17.950117439204067
894.0000000000008;18.064644332280775
895.0000000000008;18.179757247524755
896.0000000000008;18.29545863693866
897.0000000000008;18.41175095980803
898.0000000000008;18.52863668271551
899.0000000000007;18.64611827955502
900.0000000000007;18.76419823154595
901.0000000000009;18.90469511866463
902.0000000000008;19.045795345406813
903.0000000000008;19.1875014150537
904.0000000000008;19.329815838268907
905.0000000000008;19.472741133112752
906.0000000000008;19.61627982505653
907.0000000000007;19.760434446996804
908.0000000000009;19.905207539269796
909.0000000000009;20.05060164966557
910.0000000000009;20.196619333442513
911.0000000000008;20.26881166501538
912.0000000000008;20.341632702948438
913.0000000000008;20.415085024991043
914.0000000000008;20.48917121641838
915.0000000000008;20.563893870045785
916.0000000000007;20.639255586243216
917.0000000000009;20.715258972949712
918.0000000000009;20.79190664568778
919.0000000000008;20.869201227577925
920.0000000000008;20.947145349353107
921.0000000000008;21.04207161056406
922.0000000000008;21.13765269602136
923.0000000000008;21.233891259382364
924.0000000000009;21.330789961975018
925.0000000000009;21.428351472812228
926.0000000000009;21.526578468606647
927.0000000000009;21.625473633785113
928.0000000000009;21.725039660503285
929.0000000000009;21.825279248660237
930.0000000000007;21.926195105913095
931.0000000000007;22.046332054108625
932.0000000000007;22.167150710046997
933.0000000000009;22.288653804747398
934.0000000000009;22.410844077045574
935.0000000000009;22.5337242736087
936.0000000000009;22.65729714895004
937.0000000000009;22.78156546544362
938.0000000000007;22.906531993338973
939.0000000000007;23.032199510775918
940.0000000000009;23.158570803799336
941.0000000000009;23.343084819058248
942.0000000000009;23.52830820576751
943.0000000000009;23.714243773775763
944.0000000000009;23.900894340895867
945.0000000000009;24.088262732919752
946.0000000000009;24.276351783633196
947.0000000000007;24.46516433483078
948.0000000000007;24.654703236330654
949.0000000000009;24.844971345989567
950.0000000000009;25.03597152971754
951.0000000000009;25.15456151431412
952.0000000000009;25.273889329019916
953.0000000000009;25.393957863994824
954.0000000000009;25.514770017511882
955.0000000000007;25.636328695972285
956.0000000000009;25.758636813920344
957.0000000000009;25.8816972940584
958.0000000000009;26.005513067262022
959.0000000000009;26.130087072594876
960.0000000000009;26.255422257323836
961.0000000000009;26.37209589040509
962.0000000000009;26.489536622086007
963.0000000000007;26.60774742433346
964.0000000000007;26.726731277377752
965.0000000000009;26.846491169727862
966.0000000000009;26.967030098186427
967.0000000000009;27.08835106786503
968.0000000000009;27.210457092199217
969.0000000000009;27.333351192963786
970.0000000000009;27.45703640028784
971.0000000000009;27.809679680334078
972.0000000000009;28.163120152322062
973.0000000000009;28.517360871535143
974.0000000000009;28.87240490167209
975.0000000000009;29.228255314862107
976.0000000000009;29.58491519168013
977.0000000000009;29.942387621162133
978.0000000000009;30.300675700820435
979.0000000000009;30.659782536658923
980.0000000000007;31.019711243188485
981.0000000000009;31.026558315619827
982.0000000000009;31.034233513346173
983.0000000000009;31.042739976491305
984.0000000000009;31.05208085374735
985.0000000000009;31.062259302390242
986.0000000000009;31.07327848829503
987.0000000000009;31.08514158595138
988.0000000000009;31.097851778478947
989.0000000000009;31.11141225764288
990.0000000000009;31.125826223869208
991.0000000000009;31.3249429351002
992.0000000000009;31.52491956029038
993.0000000000009;31.725759325941446
994.0000000000009;31.927465467278044
995.0000000000009;32.130041228263224
996.0000000000009;32.333489861614005
997.0000000000009;32.537814628816996
998.0000000000009;32.743018800143794
999.0000000000009;32.9491056546668
1000.0000000000009;33.15607848027468"""

# Розділяємо дані на рядки і перетворюємо в DataFrame
rows = full_data.strip().split('\n')
data_list = []
for row in rows:
    x, y = row.split(';')
    data_list.append([float(x), float(y)])

df = pd.DataFrame(data_list, columns=['x', 'y'])

print("Перші 5 рядків даних:")
print(df.head())
print(f"\nРозмір даних: {df.shape}")
print(f"Діапазон x: від {df['x'].min()} до {df['x'].max()}")
print(f"Діапазон y: від {df['y'].min()} до {df['y'].max()}")

# Розділення на навчальну та тестову вибірки
X = df[['x']].values
y = df['y'].values

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)

print(f"\nРозмір навчальної вибірки: {X_train.shape}")
print(f"Розмір тестової вибірки: {X_test.shape}")

# Функція для створення МГУА моделі з поліноміальною функцією
def mgua_polynomial_model(X_train, y_train, X_test, degree=3):
    """
    МГУА модель на основі поліноміальної регресії
    """
    # Створення поліноміальних ознак
    poly = PolynomialFeatures(degree=degree, include_bias=False)
    X_poly_train = poly.fit_transform(X_train)
    X_poly_test = poly.transform(X_test)
    
    # Навчання лінійної регресії
    model = LinearRegression()
    model.fit(X_poly_train, y_train)
    
    return model, poly, X_poly_train, X_poly_test

# Створення та навчання моделей з різними ступенями полінома
degrees = [2, 3, 4, 5, 6]
models = {}
results = {}

print("\n" + "="*60)
print("НАВЧАННЯ МГУА МОДЕЛЕЙ З РІЗНИМИ СТУПЕНЯМИ ПОЛІНОМА")
print("="*60)

for degree in degrees:
    print(f"\n--- Модель з поліномом {degree} ступеня ---")
    
    # Створення моделі
    model, poly, X_poly_train, X_poly_test = mgua_polynomial_model(X_train, y_train, X_test, degree)
    
    # Прогнози
    y_train_pred = model.predict(X_poly_train)
    y_test_pred = model.predict(X_poly_test)
    
    # Обчислення метрик
    train_mse = mean_squared_error(y_train, y_train_pred)
    test_mse = mean_squared_error(y_test, y_test_pred)
    train_r2 = r2_score(y_train, y_train_pred)
    test_r2 = r2_score(y_test, y_test_pred)
    
    # Збереження результатів
    models[degree] = {
        'model': model,
        'poly': poly,
        'train_pred': y_train_pred,
        'test_pred': y_test_pred
    }
    
    results[degree] = {
        'train_mse': train_mse,
        'test_mse': test_mse,
        'train_r2': train_r2,
        'test_r2': test_r2
    }
    
    print(f"MSE на навчальних даних: {train_mse:.6f}")
    print(f"MSE на тестових даних: {test_mse:.6f}")
    print(f"R² на навчальних даних: {train_r2:.6f}")
    print(f"R² на тестових даних: {test_r2:.6f}")

# Візуалізація результатів
plt.figure(figsize=(20, 15))

# 1. Графік оригінальних даних та прогнозів
plt.subplot(3, 2, 1)
plt.scatter(df['x'], df['y'], alpha=0.3, label='Оригінальні дані', s=5, color='gray')
colors = ['red', 'green', 'blue', 'orange', 'purple']

for i, degree in enumerate(degrees):
    # Прогноз для всіх даних
    X_all_poly = models[degree]['poly'].transform(X)
    y_all_pred = models[degree]['model'].predict(X_all_poly)
    
    plt.plot(df['x'], y_all_pred, color=colors[i], linewidth=1.5, 
             label=f'Поліном {degree} ступеня')

plt.xlabel('x')
plt.ylabel('y')
plt.title('Порівняння МГУА моделей з різними ступенями полінома')
plt.legend()
plt.grid(True, alpha=0.3)

# 2. Графік залишків для найкращої моделі
best_degree = max(degrees, key=lambda d: results[d]['test_r2'])
best_model = models[best_degree]
y_test_pred_best = best_model['test_pred']
residuals = y_test - y_test_pred_best

plt.subplot(3, 2, 2)
plt.scatter(y_test_pred_best, residuals, alpha=0.6, s=20)
plt.axhline(y=0, color='red', linestyle='--', linewidth=2)
plt.xlabel('Прогнозовані значення')
plt.ylabel('Залишки')
plt.title(f'Залишки найкращої моделі (поліном {best_degree} ступеня)\nR² test: {results[best_degree]["test_r2"]:.4f}')
plt.grid(True, alpha=0.3)

# 3. Порівняння R² для різних моделей
plt.subplot(3, 2, 3)
degrees_list = list(results.keys())
train_r2_list = [results[d]['train_r2'] for d in degrees_list]
test_r2_list = [results[d]['test_r2'] for d in degrees_list]

x_pos = np.arange(len(degrees_list))
width = 0.35

bars1 = plt.bar(x_pos - width/2, train_r2_list, width, label='Навчальні дані', alpha=0.7, color='skyblue')
bars2 = plt.bar(x_pos + width/2, test_r2_list, width, label='Тестові дані', alpha=0.7, color='lightcoral')

# Додаємо значення на стовпці
for i, (v1, v2) in enumerate(zip(train_r2_list, test_r2_list)):
    plt.text(i - width/2, v1 + 0.01, f'{v1:.3f}', ha='center', va='bottom', fontsize=8)
    plt.text(i + width/2, v2 + 0.01, f'{v2:.3f}', ha='center', va='bottom', fontsize=8)

plt.xlabel('Ступінь полінома')
plt.ylabel('R² score')
plt.title('Порівняння якості моделей (R²)')
plt.xticks(x_pos, degrees_list)
plt.legend()
plt.grid(True, alpha=0.3)

# 4. Порівняння MSE для різних моделей
plt.subplot(3, 2, 4)
train_mse_list = [results[d]['train_mse'] for d in degrees_list]
test_mse_list = [results[d]['test_mse'] for d in degrees_list]

plt.bar(x_pos - width/2, train_mse_list, width, label='Навчальні дані', alpha=0.7, color='skyblue')
plt.bar(x_pos + width/2, test_mse_list, width, label='Тестові дані', alpha=0.7, color='lightcoral')

plt.xlabel('Ступінь полінома')
plt.ylabel('MSE')
plt.title('Порівняння якості моделей (MSE)')
plt.xticks(x_pos, degrees_list)
plt.legend()
plt.yscale('log')  # Логарифмічна шкала для кращої візуалізації
plt.grid(True, alpha=0.3)

# 5. Детальний перегляд перших 200 точок
plt.subplot(3, 2, 5)
zoom_range = 200
mask = df['x'] <= zoom_range

plt.scatter(df['x'][mask], df['y'][mask], alpha=0.5, label='Оригінальні дані', s=10, color='gray')

for i, degree in enumerate(degrees):
    X_all_poly = models[degree]['poly'].transform(X)
    y_all_pred = models[degree]['model'].predict(X_all_poly)
    
    plt.plot(df['x'][mask], y_all_pred[mask], color=colors[i], linewidth=1.5, 
             label=f'Поліном {degree} ступеня')

plt.xlabel('x')
plt.ylabel('y')
plt.title(f'Детальний перегляд (перші {zoom_range} точок)')
plt.legend()
plt.grid(True, alpha=0.3)

# 6. Розподіл залишків
plt.subplot(3, 2, 6)
plt.hist(residuals, bins=30, alpha=0.7, color='lightgreen', edgecolor='black')
plt.axvline(x=0, color='red', linestyle='--', linewidth=2)
plt.xlabel('Залишки')
plt.ylabel('Частота')
plt.title(f'Розподіл залишків найкращої моделі\n(поліном {best_degree} ступеня)')
plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

# Детальний аналіз найкращої моделі
print(f"\n{'='*60}")
print(f"ДЕТАЛЬНИЙ АНАЛІЗ НАЙКРАЩОЇ МОДЕЛІ (поліном {best_degree} ступеня)")
print(f"{'='*60}")

best_results = results[best_degree]
print(f"MSE на навчальних даних: {best_results['train_mse']:.6f}")
print(f"MSE на тестових даних: {best_results['test_mse']:.6f}")
print(f"R² на навчальних даних: {best_results['train_r2']:.6f}")
print(f"R² на тестових даних: {best_results['test_r2']:.6f}")

# Коефіцієнти моделі
best_poly_model = models[best_degree]['model']
best_poly_transformer = models[best_degree]['poly']

print(f"\nКоефіцієнти моделі:")
print(f"Intercept (вільний член): {best_poly_model.intercept_:.6f}")
feature_names = best_poly_transformer.get_feature_names_out(['x'])
for i, (name, coef) in enumerate(zip(feature_names, best_poly_model.coef_)):
    print(f"{name}: {coef:.6f}")

# Додаткова візуалізація - детальний графік найкращої моделі
plt.figure(figsize=(15, 10))

# Основні дані та прогнози
plt.subplot(2, 2, 1)
plt.scatter(df['x'], df['y'], alpha=0.2, label='Оригінальні дані', s=8, color='gray')

# Прогноз найкращої моделі для всіх точок
X_all_poly_best = best_poly_transformer.transform(X)
y_all_pred_best = best_poly_model.predict(X_all_poly_best)

plt.plot(df['x'], y_all_pred_best, color='red', linewidth=2, 
         label=f'МГУА модель (поліном {best_degree} ступеня)')

plt.xlabel('x')
plt.ylabel('y')
plt.title(f'Найкраща МГУА модель - поліном {best_degree} ступеня\n'
          f'R² (train): {best_results["train_r2"]:.4f}, '
          f'R² (test): {best_results["test_r2"]:.4f}')
plt.legend()
plt.grid(True, alpha=0.3)

# Детальний перегляд різних ділянок
zoom_ranges = [(0, 100), (100, 300), (300, 600), (600, 1000)]

for i, (start, end) in enumerate(zoom_ranges):
    plt.subplot(2, 2, i+1)
    mask = (df['x'] >= start) & (df['x'] <= end)
    
    plt.scatter(df['x'][mask], df['y'][mask], alpha=0.6, label='Оригінальні дані', s=15)
    plt.plot(df['x'][mask], y_all_pred_best[mask], color='red', linewidth=2, 
             label=f'МГУА модель')
    
    plt.xlabel('x')
    plt.ylabel('y')
    plt.title(f'Детальний перегляд (x від {start} до {end})')
    plt.legend()
    plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

# Аналіз перетренування
print(f"\n{'='*60}")
print("АНАЛІЗ ПЕРЕТРЕНУВАННЯ ТА УЗАГАЛЬНЮВАЛЬНОЇ ЗДАТНОСТІ")
print(f"{'='*60}")

for degree in degrees:
    diff_r2 = results[degree]['train_r2'] - results[degree]['test_r2']
    diff_mse = results[degree]['test_mse'] - results[degree]['train_mse']
    overfitting_ratio = diff_r2 / results[degree]['train_r2'] if results[degree]['train_r2'] != 0 else 0
    
    print(f"\nПоліном {degree} ступеня:")
    print(f"  R² train: {results[degree]['train_r2']:.4f}, R² test: {results[degree]['test_r2']:.4f}")
    print(f"  Різниця R² (train - test): {diff_r2:.6f}")
    print(f"  Різниця MSE (test - train): {diff_mse:.6f}")
    print(f"  Відношення перетренування: {overfitting_ratio:.4f}")
    
    if diff_r2 > 0.1:
        print("  ⚠️  МОЖЛИВЕ ПЕРЕТРЕНУВАННЯ!")
    elif diff_r2 < 0.01:
        print("  ✅ ВІДМІННА узагальнююча здатність")
    elif diff_r2 < 0.05:
        print("  ✅ ХОРОША узагальнююча здатність")
    else:
        print("  ⚠️  Прийнятна узагальнююча здатність")

# Функція для прогнозування
def predict_with_best_model(x_values, model, poly_transformer):
    """Функція для прогнозування з найкращою моделлю"""
    x_array = np.array(x_values).reshape(-1, 1)
    x_poly = poly_transformer.transform(x_array)
    return model.predict(x_poly)

# Приклад прогнозування для демонстрації
sample_x = [10, 50, 100, 500, 750, 1000]
predictions = predict_with_best_model(sample_x, best_poly_model, best_poly_transformer)

print(f"\nПриклад прогнозування найкращою моделлю:")
for x, pred in zip(sample_x, predictions):
    print(f"x = {x}: y_pred = {pred:.4f}")

print(f"\n{'='*60}")
print("АНАЛІЗ ЗАВЕРШЕНО УСПІШНО!")
print(f"{'='*60}")